<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="é’æ‰"><meta name="copyright" content="é’æ‰"><meta name="generator" content="Hexo 6.2.0"><meta name="theme" content="hexo-theme-yun"><title>docker .net core è‡ªåŠ¨éƒ¨ç½² | ä¸æ•¢é«˜å£°è¯­ï¼ŒææƒŠå¤©ä¸Šäºº</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.3.3/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/png" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"huafoog.github.io","root":"/","title":"é’æ‰","version":"1.10.4","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"æœç´¢...","empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹: ${query}","hits":"æ‰¾åˆ° ${hits} æ¡ç»“æœ","hits_time":"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn/?c=i","hitokoto":true},"fireworks":{"colors":null},"vendors":{"darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/hexo-theme-yun.js" type="module"></script><meta name="description" content="ä¸‹è½½ä»£ç† ä»£ç†æœåŠ¡å™¨æ± çš„ä½œç”¨ç”¨äºCIä¹Ÿå¯ä»¥ç”¨äºCD ä¸»è¦ç”¨äºç¼–è¯‘æ‰“åŒ… éƒ¨ç½²çš„è¯ä½¿ç”¨éƒ¨ç½²æ±   å½“å‰ä¸‹è½½åˆ°æœ¬åœ°äº† 1https:&#x2F;&#x2F;vstsagentpackage.azureedge.net&#x2F;agent&#x2F;2.188.4&#x2F;vsts-agent-linux-x64-2.188.4.tar.gz  åˆ›å»ºä»£ç†æ–‡ä»¶å¤¹ 1mkdir myagent &amp;&amp; cd myagent   1sudo c">
<meta property="og:type" content="article">
<meta property="og:title" content="docker .net core è‡ªåŠ¨éƒ¨ç½²">
<meta property="og:url" content="https://huafoog.github.io/p/ce36ce61b305.html">
<meta property="og:site_name" content="ä¸æ•¢é«˜å£°è¯­ï¼ŒææƒŠå¤©ä¸Šäºº">
<meta property="og:description" content="ä¸‹è½½ä»£ç† ä»£ç†æœåŠ¡å™¨æ± çš„ä½œç”¨ç”¨äºCIä¹Ÿå¯ä»¥ç”¨äºCD ä¸»è¦ç”¨äºç¼–è¯‘æ‰“åŒ… éƒ¨ç½²çš„è¯ä½¿ç”¨éƒ¨ç½²æ±   å½“å‰ä¸‹è½½åˆ°æœ¬åœ°äº† 1https:&#x2F;&#x2F;vstsagentpackage.azureedge.net&#x2F;agent&#x2F;2.188.4&#x2F;vsts-agent-linux-x64-2.188.4.tar.gz  åˆ›å»ºä»£ç†æ–‡ä»¶å¤¹ 1mkdir myagent &amp;&amp; cd myagent   1sudo c">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-11-17T08:19:12.716Z">
<meta property="article:modified_time" content="2021-11-17T08:19:12.716Z">
<meta property="article:author" content="é’æ‰">
<meta name="twitter:card" content="summary"><script>(function() {
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="æ–‡ç« ç›®å½•"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="ç«™ç‚¹æ¦‚è§ˆ"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="é’æ‰"><img width="96" loading="lazy" src="/images/avatar.jpg" alt="é’æ‰"><span class="site-author-status" title="ä¸Šå·">ğŸ˜‰</span></a><div class="site-author-name"><a href="/about/">é’æ‰</a></div><span class="site-name">ä¸æ•¢é«˜å£°è¯­ï¼ŒææƒŠå¤©ä¸Šäºº</span><sub class="site-subtitle">show time</sub><div class="site-description"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="é¦–é¡µ"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/archives/" title="å½’æ¡£"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">13</span></a></div><div class="site-state-item"><a href="/categories/" title="åˆ†ç±»"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">6</span></a></div><div class="site-state-item"><a href="/tags/" title="æ ‡ç­¾"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">10</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="æ–‡æ¡£"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:settings-line"></span></span></a></nav><hr style="margin-bottom:0.5rem"><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="æˆ‘çš„å°ä¼™ä¼´ä»¬" style="color:dodgerblue"><span class="icon iconify" data-icon="ri:genderless-line"></span></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><span class="icon iconify" data-icon="ri:contrast-2-line"></span></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E4%BB%A3%E7%90%86"><span class="toc-number">1.</span> <span class="toc-text">ä¸‹è½½ä»£ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E8%AE%BF%E9%97%AE%E4%BB%A4%E7%89%8C-%EF%BC%88PAT%EF%BC%89-%E8%BF%9B%E8%A1%8C%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81"><span class="toc-number">1.1.</span> <span class="toc-text">åˆ›å»ºè‡ªå·±çš„è®¿é—®ä»¤ç‰Œ ï¼ˆPATï¼‰ è¿›è¡Œèº«ä»½éªŒè¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%90%86"><span class="toc-number">1.2.</span> <span class="toc-text">é…ç½®ä»£ç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%87%E7%94%A8%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%BD%A2%E5%BC%8F%E8%BF%90%E8%A1%8C%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.3.</span> <span class="toc-text">é‡‡ç”¨æœåŠ¡çš„å½¢å¼è¿è¡Œä»£ç†æœåŠ¡å™¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E4%BB%A3%E7%90%86%E6%98%AF%E5%90%A6%E6%88%90%E5%8A%9F%E9%83%A8%E7%BD%B2"><span class="toc-number">1.4.</span> <span class="toc-text">æŸ¥çœ‹ä»£ç†æ˜¯å¦æˆåŠŸéƒ¨ç½²</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BACI%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E7%AE%A1%E9%81%93"><span class="toc-number">2.</span> <span class="toc-text">åˆ›å»ºCIæŒç»­é›†æˆç®¡é“</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%A7%81%E6%9C%89Docker-Registry"><span class="toc-number">2.1.</span> <span class="toc-text">åˆ›å»ºç§æœ‰Docker Registry</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAService-connections-%E6%9C%8D%E5%8A%A1%E8%BF%9E%E6%8E%A5"><span class="toc-number">2.1.1.</span> <span class="toc-text">åˆ›å»ºService connections(æœåŠ¡è¿æ¥)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E7%AE%A1%E9%81%93"><span class="toc-number">3.</span> <span class="toc-text">åˆ›å»ºæŒç»­é›†æˆç®¡é“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85git"><span class="toc-number">3.0.1.</span> <span class="toc-text">å®‰è£…git</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-WANDisco-%E4%BB%93%E5%BA%93%E5%8C%85"><span class="toc-number">3.0.2.</span> <span class="toc-text">å®‰è£… WANDisco ä»“åº“åŒ…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-Git"><span class="toc-number">3.0.3.</span> <span class="toc-text">å®‰è£… Git</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E9%AA%8C%E8%AF%81"><span class="toc-number">3.0.4.</span> <span class="toc-text">ç‰ˆæœ¬éªŒè¯</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85aspnet-5-0%E5%A4%B1%E8%B4%A5"><span class="toc-number">3.1.</span> <span class="toc-text">å®‰è£…aspnet:5.0å¤±è´¥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%89%E5%8F%96%E5%9B%BD%E5%86%85%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84%E9%95%9C%E5%83%8F"><span class="toc-number">3.1.1.</span> <span class="toc-text">æ‹‰å–å›½å†…æœåŠ¡å™¨ä¸Šçš„é•œåƒ</span></a></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="https://huafoog.github.io/p/ce36ce61b305.html"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="é’æ‰"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="ä¸æ•¢é«˜å£°è¯­ï¼ŒææƒŠå¤©ä¸Šäºº"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">docker .net core è‡ªåŠ¨éƒ¨ç½²</h1><div class="post-meta"><div class="post-time"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="åˆ›å»ºæ—¶é—´ï¼š2021-11-17 16:19:12" itemprop="dateCreated datePublished" datetime="2021-11-17T16:19:12+08:00">2021-11-17</time></div><div class="post-classify"></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><h1 id="ä¸‹è½½ä»£ç†"><a href="#ä¸‹è½½ä»£ç†" class="headerlink" title="ä¸‹è½½ä»£ç†"></a>ä¸‹è½½ä»£ç†</h1><blockquote>
<p>ä»£ç†æœåŠ¡å™¨æ± çš„ä½œç”¨ç”¨äºCIä¹Ÿå¯ä»¥ç”¨äºCD</p>
<p>ä¸»è¦ç”¨äºç¼–è¯‘æ‰“åŒ…</p>
<p>éƒ¨ç½²çš„è¯ä½¿ç”¨éƒ¨ç½²æ± </p>
</blockquote>
<p>å½“å‰ä¸‹è½½åˆ°æœ¬åœ°äº†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://vstsagentpackage.azureedge.net/agent/2.188.4/vsts-agent-linux-x64-2.188.4.tar.gz</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºä»£ç†æ–‡ä»¶å¤¹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> myagent &amp;&amp; <span class="built_in">cd</span> myagent</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -OL https://vstsagentpackage.azureedge.net/agent/2.188.4/vsts-agent-linux-x64-2.188.4.tar.gz</span><br></pre></td></tr></table></figure>

<p>è§£å‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar zxvf vsts-agent-linux-x64-2.188.4.tar.gz</span><br></pre></td></tr></table></figure>

<p>é…ç½®ä»£ç† - åœ¨ç›®å½• <code>~/myagent</code>ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./config.sh</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯èƒ½ä¼šå‡ºç°ä¸€äº›é”™è¯¯æç¤º:Must not run with sudo</p>
<p>å…·ä½“çš„è§£å†³æ–¹æ¡ˆè¯·å‚è€ƒ<a target="_blank" rel="noopener" href="https://github.com/microsoft/azure-pipelines-agent/pull/1713/commits/15a5beea684fa35172d661f3253b93e210409fbb">https://github.com/microsoft/azure-pipelines-agent/pull/1713/commits/15a5beea684fa35172d661f3253b93e210409fbb</a></p>
<p>æ³¨æ„:ä»£ç†æœåŠ¡å™¨æ˜¯åŸºäº.NET CORE3.1ç¼–å†™,æ‰€ä»¥éœ€è¦ç›¸åº”çš„è¿è¡Œç¯å¢ƒ,å¦‚æœæ²¡æœ‰,è¯·è¿è¡Œå¦‚ä¸‹å‘½ä»¤:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/installdependencies.sh to install</span><br></pre></td></tr></table></figure>

<p>å½“å‰çš„è§£å†³æ–¹æ¡ˆ</p>
<p>ä¿®æ”¹ config.shæ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if [ $user_id -eq 0 ]; then</span><br><span class="line">    echo &quot;Must not run with sudo&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p>ä¸º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if [ $user_id -eq 0 ] &amp;&amp; [ &quot;$&#123;ALLOW_RUNASROOT:-default_value&#125;&quot; == &quot;default_value&quot; ]; then</span><br><span class="line">    echo &quot;Must not run with sudo&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./config.sh</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export ALLOW_RUNASROOT=1; ./config.sh --unattended</span><br></pre></td></tr></table></figure>

<h2 id="åˆ›å»ºè‡ªå·±çš„è®¿é—®ä»¤ç‰Œ-ï¼ˆPATï¼‰-è¿›è¡Œèº«ä»½éªŒè¯"><a href="#åˆ›å»ºè‡ªå·±çš„è®¿é—®ä»¤ç‰Œ-ï¼ˆPATï¼‰-è¿›è¡Œèº«ä»½éªŒè¯" class="headerlink" title="åˆ›å»ºè‡ªå·±çš„è®¿é—®ä»¤ç‰Œ ï¼ˆPATï¼‰ è¿›è¡Œèº«ä»½éªŒè¯"></a>åˆ›å»ºè‡ªå·±çš„è®¿é—®ä»¤ç‰Œ ï¼ˆPATï¼‰ è¿›è¡Œèº«ä»½éªŒè¯</h2><p>æˆ‘å½“å‰çš„Azure DevOpsç½‘å€ä¸ºï¼šhttps:&#x2F;&#x2F;æœºæ„.visualstudio.com&#x2F;</p>
<p>åœ¨Azure DevOpsä¸­æ‰¾åˆ° <code>User Setting</code> -&gt;<code>Personal Access Tokens</code></p>
<p><code>User Setting</code>åœ¨å³ä¸Šè§’å¤´åƒæ—è¾¹</p>
<p>Create a new personal access token</p>
<p>Scopesé€‰æ‹©Full access</p>
<p>å½“å‰tokenè¯·å¦¥å–„ä¿å­˜ åœ¨é…ç½®ä»£ç†çš„æ—¶å€™éœ€è¦ä½¿ç”¨</p>
<h2 id="é…ç½®ä»£ç†"><a href="#é…ç½®ä»£ç†" class="headerlink" title="é…ç½®ä»£ç†"></a>é…ç½®ä»£ç†</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Enter (Y/N) Accept the Team Explorer Everywhere license agreement now? (press enter for N) &gt; y</span><br><span class="line"></span><br><span class="line">&gt;&gt; Connect:</span><br><span class="line"></span><br><span class="line">Enter server URL &gt; https://dev.azure.com/æœºæ„åç§°</span><br><span class="line">Enter authentication type (press enter for PAT) &gt; </span><br><span class="line">Enter personal access token &gt; ****************************************************</span><br><span class="line">Connecting to server ...</span><br><span class="line"></span><br><span class="line">&gt;&gt; Register Agent:</span><br><span class="line"></span><br><span class="line">Enter agent pool (press enter for default) &gt; QSPool</span><br><span class="line">Enter agent name (press enter for iz2ze5jl9wtbhfev2i9kqjz) &gt; </span><br><span class="line">Scanning for tool capabilities.</span><br><span class="line">Connecting to the server.</span><br><span class="line">Enter replace? (Y/N) (press enter for N) &gt; y</span><br><span class="line">Successfully replaced the agent</span><br><span class="line">Testing agent connection.</span><br><span class="line">Enter work folder (press enter for _work) &gt; </span><br><span class="line">2021-07-14 03:18:32Z: Settings Saved.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>è¾“å…¥ã€Yã€‘æ¥å—Team Explorer Everywhereè®¸å¯åè®®ï¼›</p>
</li>
<li><p>è¾“å…¥æœåŠ¡å™¨URLï¼Œå³é¡¹ç›®çš„Azureçš„åœ°å€ï¼›</p>
<p>æˆ‘çš„Azureç½‘ç«™ä¸º <code>https://æœºæ„.visualstudio.com/</code> è¿™é‡Œæˆ‘è¾“å…¥<code>https://dev.azure.com/æœºæ„åç§°</code>æ‰æ­£ç¡®</p>
</li>
<li><p>è¾“å…¥èº«ä»½éªŒè¯ç±»å‹ï¼Œè¿™é‡Œç›´æ¥å›è½¦ï¼Œé€‰æ‹©é»˜è®¤çš„PATï¼›</p>
</li>
<li><p>è¾“å…¥ä¸ªäººè®¿é—®ä»¤ç‰Œï¼Œå³PATï¼›</p>
</li>
<li><p>è¿æ¥æœåŠ¡å™¨æˆåŠŸåï¼Œè¾“å…¥åˆ›å»ºå¥½çš„ä»£ç†æ± ï¼›</p>
</li>
<li><p>é»˜è®¤ä»£ç†åç§°ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œä¿®æ”¹ï¼›</p>
</li>
<li><p>å› ä¸ºæˆ‘ä¹‹å‰å·²ç»åˆ›å»ºè¿‡äº†ï¼Œæ‰€ä»¥æ˜¯å¦æ›¿æ¢çš„é€‰æ‹©é€‰æ‹©äº†ã€Yã€‘ï¼›</p>
</li>
<li><p>è¾“å…¥å·¥ä½œæ–‡ä»¶å¤¹ï¼Œç›´æ¥å›è½¦ï¼Œé€‰æ‹©é»˜è®¤çš„ã€_workã€‘ï¼›</p>
</li>
</ul>
<p>ç„¶åè¿è¡Œå¯åŠ¨å‘½ä»¤:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./run.sh</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå‡ºç°<code>Must not run interactively with sudo</code>ä¹Ÿéœ€è¦ä¿®æ”¹<code>run.sh</code>æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if [ $user_id -eq 0 -a -z &quot;$AGENT_ALLOW_RUNASROOT&quot; ]; then</span><br><span class="line">    echo &quot;Must not run with sudo&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p>æ”¹ä¸º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if [ $user_id -eq 0 ] &amp;&amp; [ &quot;$&#123;ALLOW_RUNASROOT:-default_value&#125;&quot; == &quot;default_value&quot; ]; then</span><br><span class="line">    echo &quot;Must not run with sudo&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<h2 id="é‡‡ç”¨æœåŠ¡çš„å½¢å¼è¿è¡Œä»£ç†æœåŠ¡å™¨"><a href="#é‡‡ç”¨æœåŠ¡çš„å½¢å¼è¿è¡Œä»£ç†æœåŠ¡å™¨" class="headerlink" title="é‡‡ç”¨æœåŠ¡çš„å½¢å¼è¿è¡Œä»£ç†æœåŠ¡å™¨"></a>é‡‡ç”¨æœåŠ¡çš„å½¢å¼è¿è¡Œä»£ç†æœåŠ¡å™¨</h2><p>ä¸Šé¢æˆ‘ä»¬çš„ä»£ç†æœåŠ¡å™¨è™½ç„¶ä¸Šçº¿äº†,ä½†æ˜¯åœ¨linuxä¸­æ˜¯ä¸»çº¿ç¨‹çš„å½¢å¼,é€€å‡ºå°±å…³é—­äº†..</p>
<p>æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸ºæœåŠ¡çš„å½¢å¼æ¥è¿è¡Œ.</p>
<p>è¿è¡Œå‘½ä»¤å®‰è£…æœåŠ¡:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./svc.sh install</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨æœåŠ¡:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./svc.sh start</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹æœåŠ¡çŠ¶æ€:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./svc.sh status</span><br></pre></td></tr></table></figure>

<p>åœæ­¢æœåŠ¡:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./svc.sh stop</span><br></pre></td></tr></table></figure>

<p>æ›´æ–°ç¯å¢ƒå˜é‡(å½“ä½ æœ‰å…¶ä»–æ’ä»¶å®‰è£…æˆ–è€…æ›´æ–°æ—¶)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./env.sh</span><br><span class="line">sudo ./svc.sh stop</span><br><span class="line">sudo ./svc.sh start</span><br></pre></td></tr></table></figure>

<h2 id="æŸ¥çœ‹ä»£ç†æ˜¯å¦æˆåŠŸéƒ¨ç½²"><a href="#æŸ¥çœ‹ä»£ç†æ˜¯å¦æˆåŠŸéƒ¨ç½²" class="headerlink" title="æŸ¥çœ‹ä»£ç†æ˜¯å¦æˆåŠŸéƒ¨ç½²"></a>æŸ¥çœ‹ä»£ç†æ˜¯å¦æˆåŠŸéƒ¨ç½²</h2><p>åœ¨Azure DevOpsç½‘ç«™ä¸­åˆä¸‹è§’è®¾ç½®æ‰¾åˆ°</p>
<p><code>Agent pools</code> -&gt; ä»£ç†åç§°-&gt;<code>Agents</code>   </p>
<p>æŸ¥çœ‹æ˜¯å¦Online</p>
<h1 id="åˆ›å»ºCIæŒç»­é›†æˆç®¡é“"><a href="#åˆ›å»ºCIæŒç»­é›†æˆç®¡é“" class="headerlink" title="åˆ›å»ºCIæŒç»­é›†æˆç®¡é“"></a>åˆ›å»ºCIæŒç»­é›†æˆç®¡é“</h1><h2 id="åˆ›å»ºç§æœ‰Docker-Registry"><a href="#åˆ›å»ºç§æœ‰Docker-Registry" class="headerlink" title="åˆ›å»ºç§æœ‰Docker Registry"></a>åˆ›å»ºç§æœ‰Docker Registry</h2><p>é¦–å…ˆéœ€è¦åˆ°æŒç»­é›†æˆçš„æœåŠ¡å™¨ä¸Š å®‰è£…Docker Registryæ¥è·å–æˆ‘ä»¬çš„docker image</p>
<p>æ‹‰å–registryé•œåƒ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull registry:2.7.0</span><br></pre></td></tr></table></figure>

<p>registry 2.7ä»¥ä¸Šåˆ é™¤äº†åŒ… apache2-utils</p>
<p>åˆ›å»ºç¥¨æ®æ–‡ä»¶å¤¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ~/auth ~/auth/registry &amp;&amp; cd ~/auth/registry</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºhtpasswd</p>
<p>myuser ï¼šè´¦å·</p>
<p>mypasswordï¼šå¯†ç </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --entrypoint htpasswd registry:2.7.0 -Bbn myuser mypassword &gt; htpasswd</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºæ–‡ä»¶å¤¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ~/data/registry</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œæˆ‘å¿…é¡»å°†æˆ‘çš„å‡­æ®æ·»åŠ åˆ°æ³¨å†Œè¡¨ä¸­ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘å°†åœ¨å®¹å™¨ä¸­å®‰è£…authç›®å½•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run  -d -p 8081:5000 --restart=unless-stopped --name registry-auth \</span><br><span class="line">  -v  /root/auth/registry:/auth \</span><br><span class="line">  -v /data/registry:/var/lib/registry \</span><br><span class="line">  -e &quot;REGISTRY_AUTH=htpasswd&quot; \</span><br><span class="line">  -e  &quot;REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm&quot; \</span><br><span class="line">  -e  REGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswd \</span><br><span class="line">  registry</span><br></pre></td></tr></table></figure>

<p>ç„¶åé€šè¿‡nginxä»£ç†é…ç½®https</p>
<p>é…ç½®åçš„åœ°å€ä¸º<a target="_blank" rel="noopener" href="https://xxx:8081/v2">https://xxx:8081/v2</a></p>
<h3 id="åˆ›å»ºService-connections-æœåŠ¡è¿æ¥"><a href="#åˆ›å»ºService-connections-æœåŠ¡è¿æ¥" class="headerlink" title="åˆ›å»ºService connections(æœåŠ¡è¿æ¥)"></a>åˆ›å»ºService connections(æœåŠ¡è¿æ¥)</h3><p>åœ¨Azure DevOpsç½‘ç«™ä¸­åˆä¸‹è§’è®¾ç½®æ‰¾åˆ°</p>
<p><code>Service conntections</code>-&gt;<code>New service connection</code>-&gt;é€‰ä¸­Docker Registryç‚¹å‡»ä¸‹ä¸€æ­¥-&gt; é€‰æ‹©others </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">https://index.docker.io/v2/ é…ç½®çš„é•œåƒä»£ç† éœ€è¦é…ç½®æˆhttps</span><br><span class="line"></span><br><span class="line">Docker ID ï¼šmyuser </span><br><span class="line"></span><br><span class="line">Docker Passwordï¼š mypassword</span><br><span class="line"></span><br><span class="line">æ·»å†™Service connection nameç‚¹å‡»ä¿å­˜</span><br></pre></td></tr></table></figure>



<h1 id="åˆ›å»ºæŒç»­é›†æˆç®¡é“"><a href="#åˆ›å»ºæŒç»­é›†æˆç®¡é“" class="headerlink" title="åˆ›å»ºæŒç»­é›†æˆç®¡é“"></a>åˆ›å»ºæŒç»­é›†æˆç®¡é“</h1><p>æ‰¾åˆ°Pipelinesèœå•-&gt;New pipeline</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Connect :Azure Repos Git</span><br><span class="line"></span><br><span class="line">Selectï¼šé€‰æ‹©ä¸€ä¸ªé¡¹ç›®</span><br><span class="line">//é…ç½®ç®¡é“ é€‰æ‹© docker</span><br><span class="line">Configureï¼šdocker</span><br></pre></td></tr></table></figure>

<p>Yamlé…ç½®</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># Docker</span><br><span class="line"># Build a Docker image</span><br><span class="line"># https://docs.microsoft.com/azure/devops/pipelines/languages/docker</span><br><span class="line"></span><br><span class="line">trigger:</span><br><span class="line">- master</span><br><span class="line"></span><br><span class="line">resources:</span><br><span class="line">- repo: self</span><br><span class="line"></span><br><span class="line">variables:</span><br><span class="line">  tag: &#x27;$(Build.BuildId)&#x27;</span><br><span class="line"></span><br><span class="line">stages:</span><br><span class="line">- stage: Build</span><br><span class="line">  displayName: Build image</span><br><span class="line">  jobs:</span><br><span class="line">  - job: Build</span><br><span class="line">    displayName: Build</span><br><span class="line">    pool: QSPool</span><br><span class="line">    steps:</span><br><span class="line">    - task: Docker@2</span><br><span class="line">      inputs:</span><br><span class="line">        containerRegistry: &#x27;QSDockerRegistry&#x27;</span><br><span class="line">        repository: &#x27;qs.api&#x27;</span><br><span class="line">        command: &#x27;buildAndPush&#x27;</span><br><span class="line">        Dockerfile: &#x27;**/Dockerfile&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…git"><a href="#å®‰è£…git" class="headerlink" title="å®‰è£…git"></a>å®‰è£…git</h3><ul>
<li><h3 id="å®‰è£…-WANDisco-ä»“åº“åŒ…"><a href="#å®‰è£…-WANDisco-ä»“åº“åŒ…" class="headerlink" title="å®‰è£… WANDisco ä»“åº“åŒ…"></a>å®‰è£… WANDisco ä»“åº“åŒ…</h3><p><code>yum install http://opensource.wandisco.com/centos/7/git/x86_64/wandisco-git-release-7-2.noarch.rpm</code></p>
</li>
<li><h3 id="å®‰è£…-Git"><a href="#å®‰è£…-Git" class="headerlink" title="å®‰è£… Git"></a>å®‰è£… Git</h3><p><code>yum -y install git</code></p>
</li>
<li><h3 id="ç‰ˆæœ¬éªŒè¯"><a href="#ç‰ˆæœ¬éªŒè¯" class="headerlink" title="ç‰ˆæœ¬éªŒè¯"></a>ç‰ˆæœ¬éªŒè¯</h3><p><code>git version</code></p>
</li>
</ul>
<h2 id="å®‰è£…aspnet-5-0å¤±è´¥"><a href="#å®‰è£…aspnet-5-0å¤±è´¥" class="headerlink" title="å®‰è£…aspnet:5.0å¤±è´¥"></a>å®‰è£…aspnet:5.0å¤±è´¥</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/PatrickLiu/p/14327352.html">è§£å†³æ–¹æ¡ˆ</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mcr.microsoft.com/dotnet/aspnet:5.0</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Error response from daemon: Head <a target="_blank" rel="noopener" href="https://mcr.microsoft.com/v2/dotnet/aspnet/manifests/5.0">https://mcr.microsoft.com/v2/dotnet/aspnet/manifests/5.0</a>: read tcp 172.17.85.195:49560-&gt;13.75.34.156:443: read: connection reset by peer</p>
</blockquote>
<p>è¯¥é—®é¢˜å‡ºç°çš„åŸå› æ˜¯å› ä¸ºæˆ‘ä»¬æ— æ³•è®¿é—®mcr.microsoft.comçš„é•œåƒ éœ€è¦æ›´æ¢ä¸€ä¸ªå¯ä»¥è®¿é—®çš„é•œåƒæºåœ°å€</p>
<h3 id="æ‹‰å–å›½å†…æœåŠ¡å™¨ä¸Šçš„é•œåƒ"><a href="#æ‹‰å–å›½å†…æœåŠ¡å™¨ä¸Šçš„é•œåƒ" class="headerlink" title="æ‹‰å–å›½å†…æœåŠ¡å™¨ä¸Šçš„é•œåƒ"></a>æ‹‰å–å›½å†…æœåŠ¡å™¨ä¸Šçš„é•œåƒ</h3><p>åŠ é€Ÿçš„æœ¬è´¨æ˜¯å› ä¸ºæˆ‘å°†é•œåƒæ¨é€åˆ°äº†å›½å†…çš„æœåŠ¡å™¨ï¼Œç›®å‰åœ¨ä»¥ä¸‹æœåŠ¡å™¨å‡å­˜åœ¨é•œåƒ:</p>
<p>  é˜¿é‡Œäº‘ï¼šregistry.cn-hangzhou.aliyuncs.com&#x2F;newbe36524<br>  è…¾è®¯äº‘ï¼šccr.ccs.tencentyun.com&#x2F;mcr_newbe36524</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull registry.cn-hangzhou.aliyuncs.com/newbe36524/aspnet:5.0</span><br></pre></td></tr></table></figure>

</div></section><ul class="post-copyright"><li class="post-copyright-author"><strong>æœ¬æ–‡ä½œè€…ï¼š</strong>é’æ‰</li><li class="post-copyright-link"><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong><a href="https://huafoog.github.io/p/ce36ce61b305.html" title="docker .net core è‡ªåŠ¨éƒ¨ç½²">https://huafoog.github.io/p/ce36ce61b305.html</a></li><li class="post-copyright-license"><strong>ç‰ˆæƒå£°æ˜ï¼š</strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é»˜è®¤é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> è®¸å¯åè®®ã€‚</li></ul></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/p/af44f2677e16.html" rel="prev" title="Dockeræ­å»ºnginx"><span class="icon iconify" data-icon="ri:arrow-left-s-line"></span><span class="post-nav-text">Dockeræ­å»ºnginx</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/p/9417a454eb43.html" rel="next" title="å¾®ä¿¡å°ç¨‹åºè®¢é˜…æ¶ˆæ¯æ¨é€"><span class="post-nav-text">å¾®ä¿¡å°ç¨‹åºè®¢é˜…æ¶ˆæ¯æ¨é€</span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div><div class="hty-card" id="comment"></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 â€“ 2022 </span><span class="with-love" id="animate"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> é’æ‰</span></div><div class="powered"><span>ç”± <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> é©±åŠ¨ v6.2.0</span><span class="footer-separator">|</span><span>ä¸»é¢˜ - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.10.4</span></div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a></body></html>